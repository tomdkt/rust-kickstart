#name: CI
#
#on:
#  push:
#    branches: [ main, develop ]
#  pull_request:
#    branches: [ main, develop ]
#
#env:
#  CARGO_TERM_COLOR: always
#  RUST_BACKTRACE: 1
#
#jobs:
#  test:
#    name: Test Suite
#    runs-on: ubuntu-latest
#
#    services:
#      postgres:
#        image: postgres:15
#        env:
#          POSTGRES_PASSWORD: postgres
#          POSTGRES_DB: test_db
#        options: >-
#          --health-cmd pg_isready
#          --health-interval 10s
#          --health-timeout 5s
#          --health-retries 5
#        ports:
#          - 5432:5432
#
#    steps:
#    - name: Checkout code
#      uses: actions/checkout@v4
#
#    - name: Install Rust toolchain
#      uses: dtolnay/rust-toolchain@stable
#      with:
#        components: rustfmt, clippy
#
#    - name: Cache dependencies
#      uses: Swatinem/rust-cache@v2
#
#    - name: Set up environment
#      run: |
#        echo "DATABASE_URL=postgresql://postgres:postgres@localhost:5432/test_db" >> $GITHUB_ENV
#
#    - name: Run database migrations
#      run: |
#        cargo install sqlx-cli --no-default-features --features postgres
#        sqlx database create
#        sqlx migrate run
#
#    - name: Check formatting
#      run: cargo fmt -- --check
#
#    - name: Run Clippy
#      run: cargo clippy --all-targets --all-features -- -D warnings
#
#    - name: Run tests
#      run: cargo test --verbose
#
#    - name: Check documentation
#      run: cargo doc --no-deps --document-private-items
#
#  security:
#    name: Security Audit
#    runs-on: ubuntu-latest
#    steps:
#    - name: Checkout code
#      uses: actions/checkout@v4
#
#    - name: Install Rust toolchain
#      uses: dtolnay/rust-toolchain@stable
#
#    - name: Cache dependencies
#      uses: Swatinem/rust-cache@v2
#
#    - name: Run security audit
#      run: |
#        cargo install cargo-audit
#        cargo audit
#
#  coverage:
#    name: Code Coverage
#    runs-on: ubuntu-latest
#
#    services:
#      postgres:
#        image: postgres:15
#        env:
#          POSTGRES_PASSWORD: postgres
#          POSTGRES_DB: test_db
#        options: >-
#          --health-cmd pg_isready
#          --health-interval 10s
#          --health-timeout 5s
#          --health-retries 5
#        ports:
#          - 5432:5432
#
#    steps:
#    - name: Checkout code
#      uses: actions/checkout@v4
#
#    - name: Install Rust toolchain
#      uses: dtolnay/rust-toolchain@stable
#      with:
#        components: llvm-tools-preview
#
#    - name: Cache dependencies
#      uses: Swatinem/rust-cache@v2
#
#    - name: Install cargo-llvm-cov
#      run: cargo install cargo-llvm-cov
#
#    - name: Set up environment
#      run: |
#        echo "DATABASE_URL=postgresql://postgres:postgres@localhost:5432/test_db" >> $GITHUB_ENV
#
#    - name: Run database migrations
#      run: |
#        cargo install sqlx-cli --no-default-features --features postgres
#        sqlx database create
#        sqlx migrate run
#
#    - name: Generate coverage report
#      run: cargo llvm-cov --all-features --workspace --lcov --output-path lcov.info
#
#    - name: Upload coverage to Codecov
#      uses: codecov/codecov-action@v3
#      with:
#        files: lcov.info
#        fail_ci_if_error: true